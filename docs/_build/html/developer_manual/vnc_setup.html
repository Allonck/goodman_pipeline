

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setting up VNC Servers &mdash; Goodman HTS Pipeline Documentation 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Goodman HTS Pipeline Documentation
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Setting up VNC Servers</a><ul>
<li><a class="reference internal" href="#login-as-root-or-administrative-user">Login as root or administrative user</a></li>
<li><a class="reference internal" href="#install-gnome">Install GNOME</a></li>
<li><a class="reference internal" href="#install-tigervnc">Install Tigervnc</a></li>
<li><a class="reference internal" href="#configure-the-vnc-user">Configure the VNC user</a></li>
<li><a class="reference internal" href="#configuring-the-firewall">Configuring the Firewall</a></li>
<li><a class="reference internal" href="#setting-the-vnc-password">Setting the VNC password</a></li>
<li><a class="reference internal" href="#enable-service">Enable Service</a></li>
<li><a class="reference internal" href="#log-in-using-your-new-vnc-account">Log in using your new vnc account</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Goodman HTS Pipeline Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Setting up VNC Servers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer_manual/vnc_setup.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="setting-up-vnc-servers">
<span id="dev-vnc-setup"></span><h1>Setting up VNC Servers<a class="headerlink" href="#setting-up-vnc-servers" title="Permalink to this headline">¶</a></h1>
<p>The SOAR Telescope Data Reduction Servers run Centos 7, below are the
instructions to set it up. The original instructions where obtained from
<a class="reference external" href="https://www.howtoforge.com/vnc-server-installation-on-centos-7">this website</a></p>
<div class="section" id="login-as-root-or-administrative-user">
<h2>Login as root or administrative user<a class="headerlink" href="#login-as-root-or-administrative-user" title="Permalink to this headline">¶</a></h2>
<p>A non-root administrative user was provided for basic server management, I would
recommend not going further than installing necessary programs or system
configurations such as the one described in this document. For any other aspects
please contact CISS. For passwords please contact your supervisor to get the
appropriate documents.</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">ssh</span> <span class="pre">sdevel&#64;soardataX</span></code></div></blockquote>
<p>Where <code class="docutils literal"><span class="pre">X</span></code> can be <code class="docutils literal"><span class="pre">1</span></code>, <code class="docutils literal"><span class="pre">2</span></code> or <code class="docutils literal"><span class="pre">3</span></code></p>
</div>
<div class="section" id="install-gnome">
<h2>Install GNOME<a class="headerlink" href="#install-gnome" title="Permalink to this headline">¶</a></h2>
<p>For this application we have chosen GNOME which can be installed with the
following command.</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">yum</span> <span class="pre">groupinstall</span> <span class="pre">&quot;GNOME</span> <span class="pre">Desktop&quot;</span></code></div></blockquote>
<p>Answer <code class="docutils literal"><span class="pre">yes</span></code> or <code class="docutils literal"><span class="pre">y</span></code> to approve the installation</p>
</div>
<div class="section" id="install-tigervnc">
<h2>Install Tigervnc<a class="headerlink" href="#install-tigervnc" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">yum</span> <span class="pre">install</span> <span class="pre">tigervnc-server</span></code></div></blockquote>
</div>
<div class="section" id="configure-the-vnc-user">
<h2>Configure the VNC user<a class="headerlink" href="#configure-the-vnc-user" title="Permalink to this headline">¶</a></h2>
<p>For this example we will be using the username <code class="docutils literal"><span class="pre">goodman</span></code>.</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">useradd</span> <span class="pre">goodman</span></code></div></blockquote>
<p>In order to add a password, do:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">passwd</span> <span class="pre">goodman</span></code></div></blockquote>
<p>Type the password for the <code class="docutils literal"><span class="pre">goodman</span></code> user and then verify it by typing it again.</p>
<p>Copy the default vncserver configuration file with the following command.</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">cp</span> <span class="pre">/lib/systemd/system/vncserver&#64;.service</span> <span class="pre">\</span></code></dt>
<dd><code class="docutils literal"><span class="pre">/etc/systemd/system/vncserver&#64;:1.service</span></code></dd>
</dl>
</div></blockquote>
<p>And now edit it with your favorite text editor. My preferred text editor for a
terminal is <code class="docutils literal"><span class="pre">vim</span></code>.</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">vim</span> <span class="pre">/etc/systemd/system/vncserver&#64;:1.service</span></code></div></blockquote>
<p>replace all <code class="docutils literal"><span class="pre">&lt;USER&gt;</span></code> appearances by <code class="docutils literal"><span class="pre">goodman</span></code></p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># The vncserver service unit file</span>
<span class="c1">#</span>
<span class="c1"># Quick HowTo:</span>
<span class="c1"># 1. Copy this file to /etc/systemd/system/vncserver@.service</span>
<span class="c1"># 2. Edit /etc/systemd/system/vncserver@.service, replacing &lt;USER&gt;</span>
<span class="c1">#    with the actual user name. Leave the remaining lines of the file unmodified</span>
<span class="c1">#    (ExecStart=/usr/sbin/runuser -l &lt;USER&gt; -c &quot;/usr/bin/vncserver %i&quot;</span>
<span class="c1">#     PIDFile=/home/&lt;USER&gt;/.vnc/%H%i.pid)</span>
<span class="c1"># 3. Run `systemctl daemon-reload`</span>
<span class="c1"># 4. Run `systemctl enable vncserver@:&lt;display&gt;.service`</span>
<span class="c1">#</span>
<span class="c1"># DO NOT RUN THIS SERVICE if your local area network is</span>
<span class="c1"># untrusted!  For a secure way of using VNC, you should</span>
<span class="c1"># limit connections to the local host and then tunnel from</span>
<span class="c1"># the machine you want to view VNC on (host A) to the machine</span>
<span class="c1"># whose VNC output you want to view (host B)</span>
<span class="c1">#</span>
<span class="c1"># [user@hostA ~]$ ssh -v -C -L 590N:localhost:590M hostB</span>
<span class="c1">#</span>
<span class="c1"># this will open a connection on port 590N of your hostA to hostB&#39;s port 590M</span>
<span class="c1"># (in fact, it ssh-connects to hostB and then connects to localhost (on hostB).</span>
<span class="c1"># See the ssh man page for details on port forwarding)</span>
<span class="c1">#</span>
<span class="c1"># You can then point a VNC client on hostA at vncdisplay N of localhost and with</span>
<span class="c1"># the help of ssh, you end up seeing what hostB makes available on port 590M</span>
<span class="c1">#</span>
<span class="c1"># Use &quot;-nolisten tcp&quot; to prevent X connections to your VNC server via TCP.</span>
<span class="c1">#</span>
<span class="c1"># Use &quot;-localhost&quot; to prevent remote VNC clients connecting except when</span>
<span class="c1"># doing so through a secure tunnel.  See the &quot;-via&quot; option in the</span>
<span class="c1"># `man vncviewer&#39; manual page.</span>


<span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
<span class="n">Description</span><span class="o">=</span><span class="n">Remote</span> <span class="n">desktop</span> <span class="n">service</span> <span class="p">(</span><span class="n">VNC</span><span class="p">)</span>
<span class="n">After</span><span class="o">=</span><span class="n">syslog</span><span class="o">.</span><span class="n">target</span> <span class="n">network</span><span class="o">.</span><span class="n">target</span>

<span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<span class="n">Type</span><span class="o">=</span><span class="n">forking</span>
<span class="c1"># Clean any existing files in /tmp/.X11-unix environment</span>
<span class="n">ExecStartPre</span><span class="o">=/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;/usr/bin/vncserver -kill </span><span class="si">%i</span><span class="s1"> &gt; /dev/null 2&gt;&amp;1 || :&#39;</span>
<span class="hll"><span class="n">ExecStart</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">runuser</span> <span class="o">-</span><span class="n">l</span> <span class="o">&lt;</span><span class="n">USER</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;/usr/bin/vncserver </span><span class="si">%i</span><span class="s2">&quot;</span>
</span><span class="hll"><span class="n">PIDFile</span><span class="o">=/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">USER</span><span class="o">&gt;/.</span><span class="n">vnc</span><span class="o">/%</span><span class="n">H</span><span class="o">%</span><span class="n">i</span><span class="o">.</span><span class="n">pid</span>
</span><span class="n">ExecStop</span><span class="o">=/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;/usr/bin/vncserver -kill </span><span class="si">%i</span><span class="s1"> &gt; /dev/null 2&gt;&amp;1 || :&#39;</span>

<span class="p">[</span><span class="n">Install</span><span class="p">]</span>
<span class="n">WantedBy</span><span class="o">=</span><span class="n">multi</span><span class="o">-</span><span class="n">user</span><span class="o">.</span><span class="n">target</span>
</pre></div>
</td></tr></table></div>
<p>So lines 42 and 43 will look like this now:</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">ExecStart</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">runuser</span> <span class="o">-</span><span class="n">l</span> <span class="n">goodman</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;/usr/bin/vncserver </span><span class="si">%i</span><span class="s2">&quot;</span>
<span class="n">PIDFile</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">goodman</span><span class="o">/.</span><span class="n">vnc</span><span class="o">/%</span><span class="n">H</span><span class="o">%</span><span class="n">i</span><span class="o">.</span><span class="n">pid</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="configuring-the-firewall">
<h2>Configuring the Firewall<a class="headerlink" href="#configuring-the-firewall" title="Permalink to this headline">¶</a></h2>
<p>If you have a firewall you need to do the following commands:</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">firewall-cmd</span> <span class="pre">--permanent</span> <span class="pre">--zone=public</span> <span class="pre">--add-service</span> <span class="pre">vnc-server</span></code></p>
<p><code class="docutils literal"><span class="pre">firewall-cmd</span> <span class="pre">--reload</span></code></p>
</div></blockquote>
</div>
<div class="section" id="setting-the-vnc-password">
<h2>Setting the VNC password<a class="headerlink" href="#setting-the-vnc-password" title="Permalink to this headline">¶</a></h2>
<p>Login as <code class="docutils literal"><span class="pre">goodman</span></code></p>
<blockquote>
<div><code class="docutils literal"><span class="pre">su</span> <span class="pre">goodman</span></code></div></blockquote>
<p>And run vncserver, this will ask you the VNC password, don’t confuse it with
your <cite>user</cite> password.</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">vncserver</span></code></div></blockquote>
<p>Type your password and verify it by retyping it when requested.</p>
</div>
<div class="section" id="enable-service">
<h2>Enable Service<a class="headerlink" href="#enable-service" title="Permalink to this headline">¶</a></h2>
<p>Exit the <code class="docutils literal"><span class="pre">goodman</span></code> user</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">exit</span></code></div></blockquote>
<p>Now you should be logged in as the <code class="docutils literal"><span class="pre">sdevel</span></code> user.</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">daemon-reload</span></code></p>
<p><code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">vncserver&#64;:1.service</span></code></p>
<p><code class="docutils literal"><span class="pre">reboot</span></code></p>
</div></blockquote>
<p>You will loose conection after this, wait for a reasonable time (1 minute or so)
and then log in again as <code class="docutils literal"><span class="pre">sdevel</span></code></p>
<blockquote>
<div><code class="docutils literal"><span class="pre">ssh</span> <span class="pre">sdevel&#64;soardataX</span></code></div></blockquote>
<p>Remember that <code class="docutils literal"><span class="pre">X</span></code> can be <code class="docutils literal"><span class="pre">1</span></code>, <code class="docutils literal"><span class="pre">2</span></code> or <code class="docutils literal"><span class="pre">3</span></code> and should be the same that you
used at the beginning.</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">vncserver&#64;:1.service</span></code></div></blockquote>
</div>
<div class="section" id="log-in-using-your-new-vnc-account">
<h2>Log in using your new vnc account<a class="headerlink" href="#log-in-using-your-new-vnc-account" title="Permalink to this headline">¶</a></h2>
<p>Using your vnc client of choice try to connect to the server. I will be using
<code class="docutils literal"><span class="pre">vncviewer</span></code> for this example:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">vncviewer</span> <span class="pre">soardataX:1</span></code></div></blockquote>
<p>Remember that <code class="docutils literal"><span class="pre">X</span></code> has to be the same of the beginning (<code class="docutils literal"><span class="pre">1</span></code>, <code class="docutils literal"><span class="pre">2</span></code> or <code class="docutils literal"><span class="pre">3</span></code>).</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017 NOAO/AURA, Inc. All rights reserved..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>